<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تست تولید ساختار دیتابیس - DataSave</title>
    
    <!-- Fonts -->
    <link rel="stylesheet" href="assets/fonts/vazirmatn.css">
    <link rel="stylesheet" href="assets/fonts/minimal-icons.css">
    
    <!-- CSS -->
    <link rel="stylesheet" href="assets/css/admin/variables.css">
    <link rel="stylesheet" href="assets/css/admin/header.css">
    <link rel="stylesheet" href="assets/css/admin/sidebar.css">
    <link rel="stylesheet" href="assets/css/admin/content.css">
    <link rel="stylesheet" href="assets/css/admin/modules/data-management.css">
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Vazirmatn', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .test-section {
            margin-bottom: 30px;
        }
        
        .test-section h3 {
            color: #333;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .test-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .test-btn {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s ease;
        }
        
        .test-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .test-btn.success {
            background: #28a745;
        }
        
        .test-btn.warning {
            background: #ffc107;
            color: #333;
        }
        
        .test-output {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>تست تولید ساختار دیتابیس</h1>
            <p>این صفحه برای تست عملکرد تولید ساختار دیتابیس از فایل Excel طراحی شده است</p>
        </div>
        
        <div class="test-section">
            <h3>1. تست بارگذاری فایل نمونه</h3>
            <div class="test-buttons">
                <button class="test-btn" onclick="simulateExcelFile()">شبیه‌سازی فایل Excel</button>
                <button class="test-btn success" onclick="loadTestData()">بارگذاری داده‌های تست</button>
            </div>
            <div id="testOutput1" class="test-output" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>2. ماژول مدیریت داده‌ها</h3>
            <div id="dataManagementModule"></div>
        </div>
        
        <div class="test-section">
            <h3>3. لاگ‌های سیستم</h3>
            <div class="test-buttons">
                <button class="test-btn warning" onclick="showSystemLogs()">نمایش لاگ‌ها</button>
                <button class="test-btn" onclick="clearLogs()">پاک کردن لاگ‌ها</button>
            </div>
            <div id="systemLogs" class="test-output" style="display: none;"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module">
        import DataManagementModule from './assets/js/admin/modules/data-management.js';
        
        // Initialize the module
        let dataModule;
        
        async function initModule() {
            try {
                console.log('شروع بارگذاری ماژول...');
                
                // Load module content
                const content = await DataManagementModule.loadContent();
                document.getElementById('dataManagementModule').innerHTML = content;
                
                // Initialize module
                dataModule = await DataManagementModule.init();
                
                console.log('ماژول با موفقیت بارگذاری شد');
                
                // Set test data for demonstration
                dataModule.analysisResult = {
                    preview: [
                        ['شناسه', 'نام', 'سن', 'شهر', 'حقوق', 'تاریخ استخدام'],
                        ['1', 'احمد رضایی', '25', 'تهران', '5000000', '1402/01/15'],
                        ['2', 'فاطمه احمدی', '30', 'اصفهان', '6000000', '1401/12/20'],
                        ['3', 'محمد حسینی', '28', 'شیراز', '5500000', '1402/02/10']
                    ]
                };
                
            } catch (error) {
                console.error('خطا در بارگذاری ماژول:', error);
                document.getElementById('dataManagementModule').innerHTML = 
                    `<div class="error">خطا در بارگذاری ماژول: ${error.message}</div>`;
            }
        }
        
        // Global functions for test buttons
        window.simulateExcelFile = function() {
            const output = document.getElementById('testOutput1');
            output.style.display = 'block';
            output.textContent = `شبیه‌سازی فایل Excel:
نام فایل: employees.xlsx
تعداد ردیف‌ها: 100
تعداد ستون‌ها: 6
ستون‌ها: شناسه، نام، سن، شهر، حقوق، تاریخ استخدام
حجم فایل: 15 کیلوبایت`;
        };
        
        window.loadTestData = function() {
            if (dataModule) {
                dataModule.generateDatabaseStructure();
                const output = document.getElementById('testOutput1');
                output.style.display = 'block';
                output.textContent = 'داده‌های تست بارگذاری شد و ساختار دیتابیس تولید شد.';
            } else {
                alert('ابتدا ماژول را بارگذاری کنید');
            }
        };
        
        window.showSystemLogs = function() {
            const logs = document.getElementById('systemLogs');
            logs.style.display = 'block';
            logs.textContent = `[${new Date().toLocaleTimeString()}] ماژول مدیریت داده‌ها بارگذاری شد
[${new Date().toLocaleTimeString()}] داده‌های تست تولید شد
[${new Date().toLocaleTimeString()}] ساختار دیتابیس ایجاد شد
[${new Date().toLocaleTimeString()}] کدهای SQL و HTML تولید شد`;
        };
        
        window.clearLogs = function() {
            document.getElementById('systemLogs').style.display = 'none';
        };
        
        // Initialize when page loads
        initModule();
    </script>
</body>
</html>