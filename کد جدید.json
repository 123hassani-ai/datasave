{
  "name": "Ø§ÛŒØ¬Ù†Øª Ú†Øª ÙØ±ÙˆØ´ ÛŒÚ© Ø¯Ùˆ Ø³Ù‡ copy",
  "nodes": [
    {
      "parameters": {
        "public": "={{ false }}",
        "options": {
          "responseMode": "responseNodes"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        704,
        352
      ],
      "id": "2a601107-12bb-40c9-b9e9-1b2b0f9afd00",
      "name": "When chat message received",
      "webhookId": "cc79ebcc-acb0-46a0-b64f-83905ae8eb5d"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=ØªÙˆ ÛŒÚ© Â«ØªÙˆÙ„ÛŒØ¯Ú©Ù†Ù†Ø¯Ù‡Ù” SQL Ø¨Ø±Ø§ÛŒ PostgreSQLÂ» Ù‡Ø³ØªÛŒ.\nÙÙ‚Ø· Ùˆ ÙÙ‚Ø· ÛŒÚ© Ú©ÙˆØ¦Ø±ÛŒ SQL Ø¨Ø¯Ù‡ Ùˆ Ø¢Ù† Ø±Ø§ Ø¯Ø§Ø®Ù„ ÙÙ†Ø³ Ø³Ù‡â€ŒØªØ§ÛŒÛŒ Markdown Ø¨Ø§ Ø¨Ø±Ú†Ø³Ø¨ Ø²Ø¨Ø§Ù† sql Ø¨Ù†ÙˆÛŒØ³:\n```sql\nSELECT ...\nÙ¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡: Ø¬Ø¯ÙˆÙ„ Â«public.sales_factÂ» Ø¨Ø§ Ù†Ø§Ù… Ù…Ø³ØªØ¹Ø§Ø± Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ sf.\n\nÙÙ‚Ø· Ø§Ø² Ù‡Ù…ÛŒÙ† Ø¬Ø¯ÙˆÙ„ Ø¨Ø®ÙˆØ§Ù† (JOIN Ù…Ù…Ù†ÙˆØ¹).\n\nØ³ØªÙˆÙ†â€ŒÙ‡Ø§:\nsf.year_jalali INT,\nsf.month_jalali INT,\nsf.section_name TEXT,\nsf.seller_name TEXT,\nsf.total_sale BIGINT,\nsf.total_profit BIGINT,\nsf.profit_percent NUMERIC,\nsf.count_items INT,\nsf.ending_inventory BIGINT,\nsf.month_purchases BIGINT,\nsf.crm_unique_id INT\n\nÙ†Ú¯Ø§Ø´Øª Ø¹Ø¨Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§:\nÂ«Ø³Ø§Ù„Â»â†’sf.year_jalali ØŒ Â«Ù…Ø§Ù‡Â»â†’sf.month_jalali ØŒ Â«Ø¯Ø³ØªÙ‡/Ø¨Ø®Ø´Â»â†’sf.section_name ØŒ Â«ÙØ±ÙˆØ´Ù†Ø¯Ù‡Â»â†’sf.seller_name.\n\nØ¨Ø±Ø§ÛŒ Ø¬Ù…Ø¹â€ŒÙ‡Ø§ Ø§Ø² SUM() Ùˆ Ø¨Ø±Ø§ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø§Ø² COUNT(*) ÛŒØ§ SUM(count_items) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.\n\nÙ…Ù‚Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù…ØªÙ†ÛŒ (Ù…Ø«Ù„ Ù†Ø§Ù… Ø¨Ø®Ø´) Ø±Ø§ Ø¯Ø± ØªÚ©â€ŒÚ©ÙˆØªÛŒØ´Ù† '...' Ø¨Ú¯Ø°Ø§Ø±.\n\nØ§Ú¯Ø± Ú©ÙˆØ¦Ø±ÛŒ Aggregate Ù†ÛŒØ³ØªØŒ LIMIT 200 Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†.\n\nÙ‡ÛŒÚ† ØªÙˆØ¶ÛŒØ­ÛŒ Ø®Ø§Ø±Ø¬ Ø§Ø² ÙÙ†Ø³ Ù†Ø¯Ù‡Ø› ÙÙ‚Ø· Ù‡Ù…Ø§Ù† ÛŒÚ© Ú©ÙˆØ¦Ø±ÛŒ Ø¯Ø±ÙˆÙ† sql ... .\n\nÙ†Ù…ÙˆÙ†Ù‡:\nSELECT SUM(sf.total_sale) AS total_laptop_sales_1403\nFROM public.sales_fact sf\nWHERE sf.section_name = 'Ù„Ù¾ ØªØ§Ù¾' AND sf.year_jalali = 1403;\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1008,
        352
      ],
      "id": "57298454-9176-44e5-9632-262188adaf48",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "chatgpt-4o-latest",
          "mode": "list",
          "cachedResultName": "chatgpt-4o-latest"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1008,
        560
      ],
      "id": "40a8f7ee-ce11-446d-86a1-54e908121d76",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "08Gg0AUAXPSgVsgj",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1104,
        560
      ],
      "id": "88bd1548-a943-424e-8f79-ba2814fd9c21",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "{{$json.sql}}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1600,
        544
      ],
      "id": "1ad1d942-d1c5-4b1c-a88b-8ba1da982cf7",
      "name": "Execute a SQL query",
      "credentials": {
        "postgres": {
          "id": "9TFSf7sk7yu0fmxU",
          "name": "Postgres one_two_three-reader_user"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let sql = String($json.sql || '').trim();\nif (!sql) throw new Error('SQL Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.');\n\n// Ø§Ø¬Ø§Ø²Ù‡ ÙÙ‚Ø· SELECT/WITH\nif (!/\\b(SELECT|WITH)\\b/i.test(sql)) {\n  throw new Error('ÙÙ‚Ø· Ú©ÙˆØ¦Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ SELECT/CTE Ù…Ø¬Ø§Ø² Ø§Ø³Øª.');\n}\n\n// Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² DDL/DML Ø®Ø·Ø±Ù†Ø§Ú©\nif (/\\b(INSERT|UPDATE|DELETE|DROP|ALTER|TRUNCATE|CREATE|GRANT|REVOKE)\\b/i.test(sql)) {\n  throw new Error('Ú©ÙˆØ¦Ø±ÛŒ Ø®Ø·Ø±Ù†Ø§Ú© Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯.');\n}\n\n// Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ ÙØ§ØµÙ„Ù‡â€ŒÙ‡Ø§ Ùˆ \\n\nsql = sql\n  .replace(/\\\\r?\\\\n/g, ' ')\n  .replace(/\\r?\\n/g, ' ')\n  .replace(/\\s+/g, ' ')\n  .trim();\n\n// Ø§Ø¬Ø¨Ø§Ø±ÛŒ: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø³Øª Ø¨Ø§ Ù†Ø§Ù…â€ŒÙ…Ø³ØªØ¹Ø§Ø± sf\n// Ø§Ú¯Ø± Ù…Ø¯Ù„ Ø§Ø´ØªØ¨Ø§Ù‡Ø§Ù‹ Â«FROM salesÂ» Ù†ÙˆØ´ØªØŒ Ø§ØµÙ„Ø§Ø­Ø´ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…\nsql = sql.replace(/\\bfrom\\s+sales\\b/i, 'FROM public.sales_fact sf');\n\n// Ø§Ú¯Ø± public.sales_fact Ù‡Ø³Øª ÙˆÙ„ÛŒ Ù†Ø§Ù…â€ŒÙ…Ø³ØªØ¹Ø§Ø± Ù†Ø¯Ø§Ø±Ø¯ØŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†\nsql = sql.replace(/\\bpublic\\.sales_fact\\b(?!\\s+sf\\b)/i, 'public.sales_fact sf');\n\n// Ø§Ú¯Ø± Ù‡ÛŒÚ† Ø§Ø«Ø±ÛŒ Ø§Ø² Ø¬Ø¯ÙˆÙ„ Ù…Ø§ Ù†Ø¨ÙˆØ¯ØŒ Ø®Ø·Ø§ Ø¨Ø¯Ù‡\nif (!/\\bfrom\\s+public\\.sales_fact\\b/i.test(sql)) {\n  throw new Error('ÙÙ‚Ø· Ø®ÙˆØ§Ù†Ø¯Ù† Ø§Ø² public.sales_fact Ù…Ø¬Ø§Ø² Ø§Ø³Øª.');\n}\n\n// Ø§ÙØ²ÙˆØ¯Ù† LIMIT Ø¯Ø± ØµÙˆØ±Øª Ù†Ø¨ÙˆØ¯Ù† Aggregate/Group\nconst hasAggregate = /\\b(SUM|AVG|COUNT|MIN|MAX)\\s*\\(/i.test(sql) || /\\bGROUP\\s+BY\\b/i.test(sql);\nif (!/\\blimit\\b/i.test(sql) && !hasAggregate) {\n  sql += ' LIMIT 200';\n}\n\nreturn [{ json: { sql } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1440,
        544
      ],
      "id": "e831c955-3b6d-4fd9-9b59-2669c46c3ca8",
      "name": "Code (Guard)"
    },
    {
      "parameters": {
        "jsCode": "let raw = $json.output ?? $json.content ?? $json.chatoutput ?? '';\nraw = (typeof raw === 'string') ? raw : JSON.stringify(raw);\n\n// Ø§Ú¯Ø± Ø§Ø´ØªØ¨Ø§Ù‡ÛŒ JSON Ø§Ø³Øª Ùˆ ÙÛŒÙ„Ø¯ sql Ø¯Ø§Ø´Øª\ntry {\n  const maybe = JSON.parse(raw);\n  if (maybe && typeof maybe.sql === 'string') raw = maybe.sql;\n} catch (_) { /* ignore */ }\n\n// Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ù…Ù…Ú©Ù† Ø¨Ø±Ø§ÛŒ Ø¨ÛŒØ±ÙˆÙ† Ú©Ø´ÛŒØ¯Ù† SQL\nlet m = null;\nm = m || raw.match(/```sql
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1280,
        544
      ],
      "id": "ffc8919a-c6ad-4a80-a320-eb8cd60f324c",
      "name": "Code(Extract)"
    },
    {
      "parameters": {
        "jsCode": "// ========= ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‚Ø§Ø¨Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ =========\nconst UNIT = 'ØªÙˆÙ…Ø§Ù†';         // ÙˆØ§Ø­Ø¯ Ù†Ù…Ø§ÛŒØ´ Ù…Ø¨Ø§Ù„Øº\nconst SHOW_TOTAL_ROW = true;   // Ù†Ù…Ø§ÛŒØ´ Ø±Ø¯ÛŒÙ Ø¬Ù…Ø¹ Ú©Ù„ Ø¨Ø±Ø§ÛŒ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¹Ø¯Ø¯ÛŒ\nconst MAX_ROWS = 200;          // Ø§Ú¯Ø± Ù„Ø§Ø²Ù… Ø¨ÙˆØ¯ Ù…Ø­Ø¯ÙˆØ¯ Ú©Ù†ÛŒØ¯ (ÛŒØ§ null Ø¨Ø±Ø§ÛŒ Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª)\n// ======================================\n\n// Ú¯Ø±ÙØªÙ† Ù‡Ù…Ù‡ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ù‡ Ø´Ú©Ù„ Ø³Ø§Ø¯Ù‡\nconst rows = $input.all().map(i => i.json);\nif (!rows || rows.length === 0) {\n  return [{ json: { message: 'â• Ù‡ÛŒÚ† Ø¯ÛŒØªØ§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.' } }];\n}\n\n// Ú©Ù…Ú©â€ŒØªØ§Ø¨Ø¹â€ŒÙ‡Ø§\nconst faNum = (n) => {\n  if (n === null || n === undefined || n === '') return 'â€”';\n  const num = Number(n);\n  if (!Number.isFinite(num)) return String(n);\n  return num.toLocaleString('fa-IR');\n};\n\nconst toFaDigitsInString = (s) => String(s).replace(/\\d+/g, d => Number(d).toLocaleString('fa-IR'));\nconst monthNameFa = (m) => ({\n  1:'ÙØ±ÙˆØ±Ø¯ÛŒÙ†',2:'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª',3:'Ø®Ø±Ø¯Ø§Ø¯',4:'ØªÛŒØ±',5:'Ù…Ø±Ø¯Ø§Ø¯',6:'Ø´Ù‡Ø±ÛŒÙˆØ±',\n  7:'Ù…Ù‡Ø±',8:'Ø¢Ø¨Ø§Ù†',9:'Ø¢Ø°Ø±',10:'Ø¯ÛŒ',11:'Ø¨Ù‡Ù…Ù†',12:'Ø§Ø³ÙÙ†Ø¯'\n})[Number(m)] || m;\n\n// Ø­Ø¯Ø³ Ù†Ø§Ù… Ø³ØªÙˆÙ† Ù…Ø§Ù‡ Ø§Ú¯Ø± Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª\nconst isMonthKey = (k) => /month(_?jalali|_?no)?$/i.test(k) || /^month$/i.test(k);\n\n// ØªØ¹ÛŒÛŒÙ† Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ Ø§Ø² Ø±ÙˆÛŒ Ø§ÙˆÙ„ÛŒÙ† Ø±Ø¯ÛŒÙ\nconst allKeys = Object.keys(rows[0] || {});\n// Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ù…ØªÙ†ÛŒ Ø±Ø§ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ Ø¨ÛŒØ§ÙˆØ±ÛŒÙ… (Ù…Ø«Ù„ Ù…Ø§Ù‡)ØŒ Ø³Ù¾Ø³ Ø¹Ø¯Ø¯ÛŒâ€ŒÙ‡Ø§\nconst sample = rows[0] || {};\nconst numericKeys = allKeys.filter(k => Number.isFinite(Number(sample[k])));\nconst nonNumericKeys = allKeys.filter(k => !numericKeys.includes(k));\n\n// Ø³ØªÙˆÙ† Ù…Ø§Ù‡ (Ø§Ú¯Ø± Ù‡Ø³Øª) Ø±Ø§ Ø§ÙˆÙ„ Ù„ÛŒØ³Øª Ø¨Ú¯Ø°Ø§Ø±\nconst monthKeys = allKeys.filter(isMonthKey);\nlet columns = [\n  ...monthKeys,\n  ...nonNumericKeys.filter(k => !monthKeys.includes(k)),\n  ...numericKeys.filter(k => !monthKeys.includes(k)),\n];\n\n// Ù…Ø­Ø¯ÙˆØ¯Ø³Ø§Ø²ÛŒ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ (Ø¯Ø±ØµÙˆØ±Øª Ù†ÛŒØ§Ø²)\nconst data = (MAX_ROWS && rows.length > MAX_ROWS) ? rows.slice(0, MAX_ROWS) : rows;\n\n// Ø³Ø§Ø®Øª Ø¬Ø¯ÙˆÙ„ Markdown\nconst header = `| ${columns.map(c => '`' + c + '`').join(' | ')} |`;\nconst sep    = `| ${columns.map(() => '---').join(' | ')} |`;\n\nconst bodyLines = data.map(r => {\n  const cells = columns.map(c => {\n    let v = r[c];\n\n    // Ø§Ú¯Ø± Ø³ØªÙˆÙ† Ù…Ø§Ù‡ Ø§Ø³ØªØŒ Ø§Ø³Ù… Ù…Ø§Ù‡ ÙØ§Ø±Ø³ÛŒ Ù†Ø´Ø§Ù† Ø¨Ø¯Ù‡\n    if (isMonthKey(c)) v = monthNameFa(v);\n\n    // Ø§Ø¹Ø¯Ø§Ø¯ Ø±Ø§ ÙØ§Ø±Ø³ÛŒ Ùˆ Ø³Ù‡â€ŒØ±Ù‚Ù…ÛŒØ› Ø¨Ø±Ø§ÛŒ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¹Ø¯Ø¯ÛŒ ÙˆØ§Ø­Ø¯ Ø±Ø§ Ù‡Ù… Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†\n    if (Number.isFinite(Number(r[c]))) {\n      return `${faNum(v)} ${UNIT}`;\n    }\n    return toFaDigitsInString(v ?? 'â€”');\n  });\n  return `| ${cells.join(' | ')} |`;\n});\n\n// Ø¬Ù…Ø¹ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¹Ø¯Ø¯ÛŒ\nlet totalLine = '';\nif (SHOW_TOTAL_ROW) {\n  const totals = {};\n  for (const col of columns) {\n    let sum = 0, anyNumeric = false;\n    for (const r of data) {\n      const val = Number(r[col]);\n      if (Number.isFinite(val)) { sum += val; anyNumeric = true; }\n    }\n    totals[col] = anyNumeric ? sum : null;\n  }\n  const totalCells = columns.map(c =>\n    totals[c] == null ? '**Ø¬Ù…Ø¹**' : `**${faNum(totals[c])} ${UNIT}**`\n  );\n  // Ø§Ú¯Ø± Ø§ÙˆÙ„ÛŒÙ† Ø³ØªÙˆÙ† Ø¹Ø¯Ø¯ÛŒ Ù†ÛŒØ³ØªØŒ Ø¯Ø± Ø§ÙˆÙ„ÛŒÙ† Ø³ØªÙˆÙ† Ø¨Ø±Ú†Ø³Ø¨ Â«Ø¬Ù…Ø¹Â» Ø±Ø§ Ø¨Ú¯Ø°Ø§Ø±\n  if (totals[columns[0]] == null) totalCells[0] = '**Ø¬Ù…Ø¹**';\n  totalLine = `\\n| ${totalCells.join(' | ')} |`;\n}\n\n// Ù¾ÛŒØºØ§Ù… Ø¨Ø§Ù„Ø§ Ùˆ Ù¾Ø§ÛŒÛŒÙ† Ø¬Ø¯ÙˆÙ„\nconst title = `## ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ø®Ù„Ø§ØµÙ‡`;\nconst info  = (rows.length > (MAX_ROWS || Infinity))\n  ? `> âš ï¸ ØªÙ†Ù‡Ø§ ${faNum(MAX_ROWS)} Ø±Ø¯ÛŒÙ Ø§Ø² ${faNum(rows.length)} Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯.`\n  : '';\nconst table = [header, sep, ...bodyLines].join('\\n') + totalLine;\n\n// Ø®Ø±ÙˆØ¬ÛŒ Ù†Ù‡Ø§ÛŒÛŒ\nconst message = `${title}\n\n${table}\n\n${info}`.trim();\n\nreturn [{ json: { message } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1792,
        544
      ],
      "id": "4998aa37-c44f-45e3-914d-a2e04a7178ad",
      "name": "Code (Formatter)"
    },
    {
      "parameters": {
        "message": "={{$json.message}}",
        "waitUserReply": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chat",
      "typeVersion": 1,
      "position": [
        2224,
        480
      ],
      "id": "feff1328-6a36-4af8-ad1f-7b5fc776ad17",
      "name": "Respond to Chat",
      "executeOnce": true,
      "retryOnFail": false,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        704,
        544
      ],
      "id": "125c917a-fdff-43a3-8c20-afb5314d30f6",
      "name": "Telegram Trigger",
      "webhookId": "56c2b341-1d87-4937-9b9c-440fa6a23ee5",
      "credentials": {
        "telegramApi": {
          "id": "lnAPOQZkapCnxIJo",
          "name": "Telegram mojtabahasani_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let chatId = $json.chat?.id || $json.message?.chat?.id;\nif (!chatId) {\n  throw new Error('chat_id Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ú©Ù‡ Ù¾ÛŒØ§Ù… Ø§Ø² ØªÙ„Ú¯Ø±Ø§Ù… Ø¢Ù…Ø¯Ù‡ Ø§Ø³Øª.');\n}\nreturn [{\n  json: {\n    message: $json.message,\n    chat_id: chatId\n  }\n}];",
        "type": "n8n-nodes-base.set",
        "typeVersion": 1,
        "position": [
          2000,
          544
        ],
        "name": "Set Chat ID"
      },
    {
      "parameters": {
        "text": "={{ $json.message }}",
        "chatId": "={{ $json.chat_id }}",
        "additionalFields": {
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2224,
        640
      ],
      "id": "9c1f2093-fd0d-4893-a171-d200b2db7007",
      "name": "Send a text message",
      "webhookId": "45cbea27-46f2-4bb1-af31-ae87548dbce4",
      "credentials": {
        "telegramApi": {
          "id": "lnAPOQZkapCnxIJo",
          "name": "Telegram mojtabahasani_bot"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Code(Extract)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query": {
      "main": [
        [
          {
            "node": "Code (Formatter)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code (Guard)": {
      "main": [
        [
          {
            "node": "Execute a SQL query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code(Extract)": {
      "main": [
        [
          {
            "node": "Code (Guard)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code (Formatter)": {
      "main": [
        [
          {
            "node": "Respond to Chat",
            "type": "main",
            "index": 0
          },
          {
            "node": "Set Chat ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Chat ID": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message": {
      "main": [
        []
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "20e47031-1d4c-42c1-8bd0-bc27d31b2f4c",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "d5c75f88fa14f5577781219e262e0d3a845921b4aaab379579f99e10d5ce7ce9"
  },
  "id": "lnJa9UBkeTRG0alx",
  "tags": []
}