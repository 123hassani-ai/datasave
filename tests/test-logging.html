<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تست سیستم لاگ‌گیری DataSave</title>
    
    <!-- Import Persian Font -->
    <link href="../assets/fonts/vazirmatn.css" rel="stylesheet">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', 'Tahoma', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .test-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 20px;
        }
        .log-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            direction: ltr;
        }
        .btn-group {
            margin-bottom: 15px;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 8px;
        }
        .status-success { background-color: #28a745; }
        .status-warning { background-color: #ffc107; }
        .status-error { background-color: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <div class="text-center mb-5">
            <h1 class="text-white mb-3">
                <i class="fas fa-file-alt me-3"></i>
                تست سیستم لاگ‌گیری DataSave
            </h1>
            <p class="text-white-50 mb-0">آزمایش عملکرد سیستم ثبت لاگ در کنسول</p>
        </div>

        <!-- وضعیت سیستم -->
        <div class="test-container">
            <h2 class="text-primary mb-4">
                <i class="fas fa-info-circle me-2"></i>
                وضعیت سیستم
            </h2>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5>لاگ‌گیری ساده</h5>
                            <span id="localStatus" class="status-indicator status-warning"></span>
                            <span id="localStatusText">در حال بررسی...</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5>پشتیبانی از فارسی</h5>
                            <span id="persianStatus" class="status-indicator status-warning"></span>
                            <span id="persianStatusText">در حال بررسی...</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5>عملکرد</h5>
                            <span id="performanceStatus" class="status-indicator status-warning"></span>
                            <span id="performanceStatusText">در حال بررسی...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- تست‌های لاگ‌گیری -->
        <div class="test-container">
            <h2 class="text-success mb-4">
                <i class="fas fa-vial me-2"></i>
                تست‌های لاگ‌گیری
            </h2>

            <div class="btn-group" role="group">
                <button class="btn btn-info" onclick="testDebugLog()">
                    <i class="fas fa-bug me-2"></i>
                    تست DEBUG
                </button>
                <button class="btn btn-success" onclick="testInfoLog()">
                    <i class="fas fa-info me-2"></i>
                    تست INFO
                </button>
                <button class="btn btn-warning" onclick="testWarnLog()">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    تست WARNING
                </button>
                <button class="btn btn-danger" onclick="testErrorLog()">
                    <i class="fas fa-times-circle me-2"></i>
                    تست ERROR
                </button>
                <button class="btn btn-dark" onclick="testFatalLog()">
                    <i class="fas fa-skull me-2"></i>
                    تست FATAL
                </button>
            </div>

            <div class="btn-group" role="group">
                <button class="btn btn-primary" onclick="testBulkLogs()">
                    <i class="fas fa-list me-2"></i>
                    تست انبوه
                </button>
                <button class="btn btn-secondary" onclick="testPerformance()">
                    <i class="fas fa-tachometer-alt me-2"></i>
                    تست عملکرد
                </button>
                <button class="btn btn-outline-danger" onclick="testConsoleOnly()">
                    <i class="fas fa-terminal me-2"></i>
                    فقط کنسول
                </button>
            </div>

            <div id="testResults" class="log-display mt-3">
لاگ‌ها اینجا نمایش داده خواهند شد...
            </div>
        </div>
    </div>

    <script src="../assets/js/modules/simple-logger.js"></script>
    <script>
        let testCounter = 0;

        // بررسی وضعیت سیستم
        function checkSystemStatus() {
            // وضعیت محلی
            if (window.Logger) {
                document.getElementById('localStatus').className = 'status-indicator status-success';
                document.getElementById('localStatusText').textContent = 'فعال';
            } else {
                document.getElementById('localStatus').className = 'status-indicator status-error';
                document.getElementById('localStatusText').textContent = 'غیرفعال';
            }

            // بررسی پشتیبانی از فارسی
            try {
                Logger.info('تست پشتیبانی از فارسی');
                document.getElementById('persianStatus').className = 'status-indicator status-success';
                document.getElementById('persianStatusText').textContent = 'پشتیبانی می‌شود';
            } catch (error) {
                document.getElementById('persianStatus').className = 'status-indicator status-error';
                document.getElementById('persianStatusText').textContent = 'خطا';
            }

            // بررسی عملکرد
            const startTime = performance.now();
            Logger.debug('تست عملکرد');
            const endTime = performance.now();
            
            if ((endTime - startTime) < 10) {
                document.getElementById('performanceStatus').className = 'status-indicator status-success';
                document.getElementById('performanceStatusText').textContent = 'عالی';
            } else {
                document.getElementById('performanceStatus').className = 'status-indicator status-warning';
                document.getElementById('performanceStatusText').textContent = 'قابل قبول';
            }
        }

        // تست‌های مختلف لاگ
        function testDebugLog() {
            Logger.debug('این یک پیام اشکال‌زدایی است', { 
                test: 'debug_test', 
                counter: ++testCounter,
                persianText: 'متن فارسی برای تست'
            });
            appendResult('✅ لاگ DEBUG ارسال شد');
        }

        function testInfoLog() {
            Logger.info('این یک پیام اطلاعاتی است', { 
                test: 'info_test', 
                counter: ++testCounter,
                user: 'کاربر تست'
            });
            appendResult('ℹ️ لاگ INFO ارسال شد');
        }

        function testWarnLog() {
            Logger.warn('این یک پیام هشدار است', { 
                test: 'warn_test', 
                counter: ++testCounter,
                warning: 'هشدار تستی'
            });
            appendResult('⚠️ لاگ WARNING ارسال شد');
        }

        function testErrorLog() {
            const testError = new Error('این یک خطای تستی است');
            Logger.error('خطای تستی رخ داده', testError, { 
                test: 'error_test', 
                counter: ++testCounter
            });
            appendResult('❌ لاگ ERROR ارسال شد');
        }

        function testFatalLog() {
            const fatalError = new Error('خطای مهلک تستی');
            Logger.fatal('خطای مهلک رخ داده', fatalError, { 
                test: 'fatal_test', 
                counter: ++testCounter,
                system: 'critical'
            });
            appendResult('💀 لاگ FATAL ارسال شد');
        }

        function testBulkLogs() {
            appendResult('🔄 شروع تست انبوه...');
            
            for (let i = 1; i <= 10; i++) {
                const level = ['debug', 'info', 'warn', 'error'][Math.floor(Math.random() * 4)];
                Logger[level](`پیام تست انبوه شماره ${i}`, {
                    bulk_test: true,
                    index: i,
                    timestamp: new Date().getTime()
                });
            }
            
            appendResult('✅ 10 لاگ انبوه ارسال شد');
        }

        function testPerformance() {
            appendResult('🚀 شروع تست عملکرد...');
            const startTime = performance.now();
            
            for (let i = 1; i <= 100; i++) {
                Logger.info(`تست عملکرد ${i}`, { performance_test: true, index: i });
            }
            
            const endTime = performance.now();
            const duration = (endTime - startTime).toFixed(2);
            appendResult(`⚡ 100 لاگ در ${duration} میلی‌ثانیه ارسال شد`);
        }

        function testConsoleOnly() {
            Logger.info('این لاگ فقط در کنسول نمایش داده می‌شود');
            Logger.warn('هشدار: لاگ‌های ساده فقط در کنسول ثبت می‌شوند');
            Logger.error('خطا: لاگ‌های ساده فایلی ایجاد نمی‌کنند');
            appendResult('🖥️ لاگ‌های تستی فقط در کنسول نمایش داده شدند');
        }

        function appendResult(message) {
            const results = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString('fa-IR');
            results.textContent += `[${timestamp}] ${message}\n`;
            results.scrollTop = results.scrollHeight;
        }

        // مقداردهی اولیه
        document.addEventListener('DOMContentLoaded', function() {
            checkSystemStatus();
            
            // بررسی وضعیت هر 10 ثانیه
            setInterval(checkSystemStatus, 10000);
            
            // لاگ اولیه
            Logger.info('صفحه تست لاگ‌گیری سبک بارگذاری شد', {
                page: 'test-logging.html',
                version: '1.0.0',
                user_agent: navigator.userAgent
            });
            
            appendResult('🎯 سیستم تست آماده است');
        });
    </script>
</body>
</html>