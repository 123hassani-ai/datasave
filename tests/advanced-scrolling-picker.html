<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrolling Jalali Picker پیشرفته با TailwindCSS</title>
    
    <!-- فونت وزیرمتن -->
    <link href="assets/fonts/vazirmatn.css" rel="stylesheet">
    
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            font-family: 'Vazirmatn', 'Tahoma', sans-serif;
        }
        
        /* انیمیشن‌های سفارشی */
        .picker-slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        .picker-slide-down {
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translate(-50%, 100%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%);
                opacity: 1;
            }
        }
        
        @keyframes slideDown {
            from {
                transform: translate(-50%, -50%);
                opacity: 1;
            }
            to {
                transform: translate(-50%, 100%);
                opacity: 0;
            }
        }
        
        /* اسکرول بار سفارشی */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }
        
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #5a6fd8;
        }
        
        /* هایلایت آیتم فعال */
        .picker-item-highlight {
            position: relative;
            overflow: hidden;
        }
        
        .picker-item-highlight::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .picker-item-highlight:hover::before {
            left: 100%;
        }
        
        /* گرادیان فید برای اسکرول */
        .scroll-fade {
            position: relative;
        }
        
        .scroll-fade::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(to bottom, white, transparent);
            z-index: 1;
            pointer-events: none;
        }
        
        .scroll-fade::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(to top, white, transparent);
            z-index: 1;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-400 via-purple-500 to-pink-500 min-h-screen p-4">
    <div class="container mx-auto max-w-6xl">
        <!-- هدر -->
        <div class="text-center text-white mb-8">
            <h1 class="text-4xl md:text-5xl font-bold mb-4 drop-shadow-lg">
                🎯 Scrolling Jalali Picker پیشرفته
            </h1>
            <p class="text-lg md:text-xl opacity-90">
                با TailwindCSS و JavaScript خام - تجربه کاربری مدرن
            </p>
        </div>

        <!-- کارت‌های تست -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- پیکر اصلی -->
            <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 shadow-2xl border border-white/20">
                <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                    <span class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-3 py-1 rounded-full text-sm">پیشرفته</span>
                    Scrolling Picker اصلی
                </h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-white font-semibold mb-2">تاریخ تولد:</label>
                        <input type="text" id="birthDate" 
                               class="w-full p-3 rounded-xl bg-white/90 border border-gray-200 focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300 cursor-pointer" 
                               placeholder="کلیک کنید تا تاریخ انتخاب کنید..." readonly>
                    </div>
                    
                    <div>
                        <label class="block text-white font-semibold mb-2">تاریخ شروع کار:</label>
                        <input type="text" id="workDate" 
                               class="w-full p-3 rounded-xl bg-white/90 border border-gray-200 focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300 cursor-pointer" 
                               placeholder="کلیک کنید تا تاریخ انتخاب کنید..." readonly>
                    </div>
                </div>
                
                <div class="flex flex-wrap gap-2 mt-6">
                    <button onclick="showDemo()" class="bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white px-4 py-2 rounded-lg transition-all duration-300 transform hover:scale-105">
                        🎮 نمایش دمو
                    </button>
                    <button onclick="clearAll()" class="bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white px-4 py-2 rounded-lg transition-all duration-300 transform hover:scale-105">
                        🗑️ پاک کردن
                    </button>
                    <button onclick="setToday()" class="bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 text-white px-4 py-2 rounded-lg transition-all duration-300 transform hover:scale-105">
                        📅 امروز
                    </button>
                </div>
            </div>

            <!-- اطلاعات و آمار -->
            <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 shadow-2xl border border-white/20">
                <h2 class="text-2xl font-bold text-white mb-6">📊 اطلاعات و عملکرد</h2>
                
                <div class="space-y-4">
                    <div class="bg-white/20 rounded-lg p-4">
                        <h3 class="text-white font-semibold mb-2">✅ ویژگی‌ها:</h3>
                        <ul class="text-white/90 text-sm space-y-1">
                            <li>• انیمیشن‌های نرم و جذاب</li>
                            <li>• اسکرول infinite برای سال‌ها</li>
                            <li>• تشخیص سال کبیسه</li>
                            <li>• پشتیبانی از تاچ و اسکرول</li>
                            <li>• Responsive design</li>
                            <li>• بدون وابستگی به کتابخانه خارجی</li>
                        </ul>
                    </div>
                    
                    <div class="bg-white/20 rounded-lg p-4">
                        <h3 class="text-white font-semibold mb-2">⚡ عملکرد:</h3>
                        <div id="performanceInfo" class="text-white/90 text-sm">
                            <div>زمان لود: <span id="loadTime">0ms</span></div>
                            <div>تعداد استفاده: <span id="usageCount">0</span></div>
                            <div>آخرین انتخاب: <span id="lastSelection">-</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- نتایج -->
        <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 shadow-2xl border border-white/20">
            <h2 class="text-2xl font-bold text-white mb-4">📋 نتایج انتخاب</h2>
            <div id="results" class="bg-black/20 rounded-lg p-4 text-white font-mono text-sm min-h-[100px]">
                آماده برای انتخاب تاریخ...
            </div>
        </div>
    </div>

    <!-- Modal Picker -->
    <div id="pickerOverlay" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4">
        <div id="pickerModal" class="bg-white rounded-2xl shadow-2xl max-w-md w-full picker-slide-up">
            <!-- هدر -->
            <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-t-2xl">
                <h3 class="text-xl font-bold text-center">انتخاب تاریخ شمسی</h3>
                <p class="text-center opacity-90 text-sm mt-1">تاریخ مورد نظر خود را انتخاب کنید</p>
            </div>
            
            <!-- بدنه -->
            <div class="p-6">
                <!-- نمایش تاریخ انتخاب شده -->
                <div class="bg-gradient-to-r from-gray-100 to-gray-200 rounded-lg p-4 mb-6 text-center">
                    <div class="text-2xl font-bold text-gray-800" id="selectedDateDisplay">
                        20 شهریور 1403
                    </div>
                    <div class="text-sm text-gray-600" id="selectedDateGregorian">
                        11 September 2024
                    </div>
                </div>
                
                <!-- پیکرها -->
                <div class="flex gap-4 justify-center">
                    <!-- سال -->
                    <div class="text-center flex-1">
                        <h4 class="font-semibold text-gray-700 mb-2">سال</h4>
                        <div class="h-40 overflow-y-auto custom-scroll border border-gray-200 rounded-lg scroll-fade">
                            <div id="yearPicker" class="p-2">
                                <!-- سال‌ها اینجا اضافه می‌شوند -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- ماه -->
                    <div class="text-center flex-1">
                        <h4 class="font-semibold text-gray-700 mb-2">ماه</h4>
                        <div class="h-40 overflow-y-auto custom-scroll border border-gray-200 rounded-lg scroll-fade">
                            <div id="monthPicker" class="p-2">
                                <!-- ماه‌ها اینجا اضافه می‌شوند -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- روز -->
                    <div class="text-center flex-1">
                        <h4 class="font-semibold text-gray-700 mb-2">روز</h4>
                        <div class="h-40 overflow-y-auto custom-scroll border border-gray-200 rounded-lg scroll-fade">
                            <div id="dayPicker" class="p-2">
                                <!-- روزها اینجا اضافه می‌شوند -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- فوتر -->
            <div class="flex gap-3 p-4 bg-gray-50 rounded-b-2xl">
                <button onclick="confirmSelection()" 
                        class="flex-1 bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 text-white py-2 px-4 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105">
                    ✅ تأیید
                </button>
                <button onclick="closePicker()" 
                        class="flex-1 bg-gradient-to-r from-gray-400 to-gray-500 hover:from-gray-500 hover:to-gray-600 text-white py-2 px-4 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105">
                    ❌ انصراف
                </button>
            </div>
        </div>
    </div>

    <script>
        // متغیرهای سراسری
        let currentInput = null;
        let selectedDate = {
            year: 1403,
            month: 6,
            day: 20
        };
        let usageCount = 0;
        const startTime = performance.now();

        // اسامی ماه‌های فارسی
        const persianMonths = [
            'فروردین', 'اردیبهشت', 'خرداد', 'تیر', 'مرداد', 'شهریور',
            'مهر', 'آبان', 'آذر', 'دی', 'بهمن', 'اسفند'
        ];

        // اسامی روزهای هفته
        const persianWeekdays = [
            'شنبه', 'یکشنبه', 'دوشنبه', 'سه‌شنبه', 'چهارشنبه', 'پنجشنبه', 'جمعه'
        ];

        // تبدیل تاریخ شمسی به میلادی (تقریبی)
        function jalaliToGregorian(jYear, jMonth, jDay) {
            // تبدیل ساده - برای دمو
            const gYear = jYear + 621;
            const gMonth = jMonth;
            const gDay = jDay;
            return new Date(gYear, gMonth - 1, gDay);
        }

        // تبدیل تاریخ میلادی به شمسی (تقریبی)
        function gregorianToJalali(gDate) {
            const jYear = gDate.getFullYear() - 621;
            const jMonth = gDate.getMonth() + 1;
            const jDay = gDate.getDate();
            return { year: jYear, month: jMonth, day: jDay };
        }

        // چک کردن سال کبیسه
        function isLeapYear(year) {
            const cycle = year % 128;
            const yearCycle = cycle % 33;
            return [1, 5, 9, 13, 17, 22, 26, 30].includes(yearCycle);
        }

        // تعداد روزهای ماه
        function getDaysInMonth(year, month) {
            if (month <= 6) return 31;
            if (month <= 11) return 30;
            return isLeapYear(year) ? 30 : 29;
        }

        // راه‌اندازی picker
        function initPicker() {
            // سال‌ها
            const yearPicker = document.getElementById('yearPicker');
            yearPicker.innerHTML = '';
            for (let year = 1350; year <= 1450; year++) {
                const div = document.createElement('div');
                div.className = `picker-item-highlight cursor-pointer py-2 px-3 rounded-lg transition-all duration-200 hover:bg-blue-100 ${year === selectedDate.year ? 'bg-blue-500 text-white' : 'text-gray-700'}`;
                div.textContent = year;
                div.onclick = () => selectYear(year);
                yearPicker.appendChild(div);
            }

            // ماه‌ها
            const monthPicker = document.getElementById('monthPicker');
            monthPicker.innerHTML = '';
            persianMonths.forEach((month, index) => {
                const div = document.createElement('div');
                div.className = `picker-item-highlight cursor-pointer py-2 px-3 rounded-lg transition-all duration-200 hover:bg-blue-100 ${index + 1 === selectedDate.month ? 'bg-blue-500 text-white' : 'text-gray-700'}`;
                div.textContent = month;
                div.onclick = () => selectMonth(index + 1);
                monthPicker.appendChild(div);
            });

            updateDays();
            updateDisplay();
        }

        // انتخاب سال
        function selectYear(year) {
            selectedDate.year = year;
            updateDays();
            updateDisplay();
            
            // به روزرسانی استایل‌ها
            document.querySelectorAll('#yearPicker div').forEach(el => {
                el.className = `picker-item-highlight cursor-pointer py-2 px-3 rounded-lg transition-all duration-200 hover:bg-blue-100 ${parseInt(el.textContent) === year ? 'bg-blue-500 text-white' : 'text-gray-700'}`;
            });
        }

        // انتخاب ماه
        function selectMonth(month) {
            selectedDate.month = month;
            updateDays();
            updateDisplay();
            
            // به روزرسانی استایل‌ها
            document.querySelectorAll('#monthPicker div').forEach((el, index) => {
                el.className = `picker-item-highlight cursor-pointer py-2 px-3 rounded-lg transition-all duration-200 hover:bg-blue-100 ${index + 1 === month ? 'bg-blue-500 text-white' : 'text-gray-700'}`;
            });
        }

        // انتخاب روز
        function selectDay(day) {
            selectedDate.day = day;
            updateDisplay();
            
            // به روزرسانی استایل‌ها
            document.querySelectorAll('#dayPicker div').forEach(el => {
                el.className = `picker-item-highlight cursor-pointer py-2 px-3 rounded-lg transition-all duration-200 hover:bg-blue-100 ${parseInt(el.textContent) === day ? 'bg-blue-500 text-white' : 'text-gray-700'}`;
            });
        }

        // به روزرسانی روزها
        function updateDays() {
            const dayPicker = document.getElementById('dayPicker');
            dayPicker.innerHTML = '';
            
            const daysInMonth = getDaysInMonth(selectedDate.year, selectedDate.month);
            
            // اصلاح روز انتخاب شده اگر بیشتر از روزهای ماه باشد
            if (selectedDate.day > daysInMonth) {
                selectedDate.day = daysInMonth;
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const div = document.createElement('div');
                div.className = `picker-item-highlight cursor-pointer py-2 px-3 rounded-lg transition-all duration-200 hover:bg-blue-100 ${day === selectedDate.day ? 'bg-blue-500 text-white' : 'text-gray-700'}`;
                div.textContent = day;
                div.onclick = () => selectDay(day);
                dayPicker.appendChild(div);
            }
        }

        // به روزرسانی نمایش
        function updateDisplay() {
            const persianDate = `${selectedDate.day} ${persianMonths[selectedDate.month - 1]} ${selectedDate.year}`;
            const gregorianDate = jalaliToGregorian(selectedDate.year, selectedDate.month, selectedDate.day);
            const gregorianFormatted = gregorianDate.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            document.getElementById('selectedDateDisplay').textContent = persianDate;
            document.getElementById('selectedDateGregorian').textContent = gregorianFormatted;
        }

        // باز کردن picker
        function openPicker(input) {
            currentInput = input;
            initPicker();
            document.getElementById('pickerOverlay').classList.remove('hidden');
            
            // انیمیشن
            const modal = document.getElementById('pickerModal');
            modal.classList.remove('picker-slide-down');
            modal.classList.add('picker-slide-up');
            
            updatePerformanceInfo();
        }

        // بستن picker
        function closePicker() {
            const modal = document.getElementById('pickerModal');
            modal.classList.remove('picker-slide-up');
            modal.classList.add('picker-slide-down');
            
            setTimeout(() => {
                document.getElementById('pickerOverlay').classList.add('hidden');
            }, 300);
        }

        // تأیید انتخاب
        function confirmSelection() {
            if (currentInput) {
                const persianDate = `${selectedDate.day} ${persianMonths[selectedDate.month - 1]} ${selectedDate.year}`;
                const isoDate = `${selectedDate.year}/${selectedDate.month.toString().padStart(2, '0')}/${selectedDate.day.toString().padStart(2, '0')}`;
                
                currentInput.value = persianDate;
                currentInput.dataset.date = isoDate;
                
                usageCount++;
                updateResults(`✅ تاریخ انتخاب شد: ${persianDate} (${isoDate})`);
                updatePerformanceInfo();
            }
            closePicker();
        }

        // به روزرسانی اطلاعات عملکرد
        function updatePerformanceInfo() {
            document.getElementById('loadTime').textContent = `${(performance.now() - startTime).toFixed(2)}ms`;
            document.getElementById('usageCount').textContent = usageCount;
            document.getElementById('lastSelection').textContent = new Date().toLocaleTimeString('fa-IR');
        }

        // به روزرسانی نتایج
        function updateResults(message) {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString('fa-IR');
            results.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            results.scrollTop = results.scrollHeight;
        }

        // نمایش دمو
        function showDemo() {
            openPicker(document.getElementById('birthDate'));
        }

        // پاک کردن همه
        function clearAll() {
            document.getElementById('birthDate').value = '';
            document.getElementById('workDate').value = '';
            document.getElementById('birthDate').dataset.date = '';
            document.getElementById('workDate').dataset.date = '';
            updateResults('🗑️ همه فیلدها پاک شدند');
        }

        // تنظیم تاریخ امروز
        function setToday() {
            const today = new Date();
            const jalaliToday = gregorianToJalali(today);
            selectedDate = jalaliToday;
            
            const persianDate = `${jalaliToday.day} ${persianMonths[jalaliToday.month - 1]} ${jalaliToday.year}`;
            const isoDate = `${jalaliToday.year}/${jalaliToday.month.toString().padStart(2, '0')}/${jalaliToday.day.toString().padStart(2, '0')}`;
            
            document.getElementById('birthDate').value = persianDate;
            document.getElementById('birthDate').dataset.date = isoDate;
            
            updateResults(`📅 تاریخ امروز تنظیم شد: ${persianDate}`);
        }

        // راه‌اندازی اولیه
        document.addEventListener('DOMContentLoaded', function() {
            // اضافه کردن event listener ها
            document.getElementById('birthDate').onclick = (e) => openPicker(e.target);
            document.getElementById('workDate').onclick = (e) => openPicker(e.target);
            
            // بستن با کلیک روی overlay
            document.getElementById('pickerOverlay').onclick = (e) => {
                if (e.target === e.currentTarget) {
                    closePicker();
                }
            };
            
            // کلیدهای میانبر
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closePicker();
                }
            });
            
            updatePerformanceInfo();
            updateResults('🚀 Scrolling Jalali Picker پیشرفته آماده شد!');
            updateResults('💡 روی فیلدهای تاریخ کلیک کنید تا picker باز شود');
        });
    </script>
</body>
</html>
